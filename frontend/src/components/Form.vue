<template>
	<div id="app">
		<form
			class="startup-form"
			@submit.prevent="submit"
		>
			<fieldset>
				<legend>Tech Stack Specification Form</legend>

				<hr>
				<div class="mb-3">
					<input type="text" class="form-control form-label" placeholder="Name of the startup" aria-label="Startup Name" required v-model="startupName">
				</div>

				<div class="mb-3">
					<label for="size" class="form-label">Startup size</label>
					<select
						class="form-select"

						aria-label="select"
						v-model="startupSize"
					>
						<option v-for="size in sizes" :key="size" :value="size">
							{{ $convertToStartCase(size) }}
						</option>
					</select>
					<div class="invalid-feedback">Please select</div>
				</div>

				<div class="mb-3">
					<label for="location" class="form-label">Startup Location</label>
					<select
						class="form-select"
						aria-label="select"
						v-model="startupLocation"
					>
						<option
							v-for="location in locations"
							:value="location"
							:key="location"
						>
							{{ location }}
						</option>
					</select>
					<div class="invalid-feedback">Please select</div>
				</div>

				<div class="mb-3">
					<label for="field" class="form-label">Startup Field</label>
					<select
						class="form-select"
						required
						aria-label="select"
						v-model="startupField"
					>
						<option v-for="field in fields" :key="field" :value="field">
							{{ $convertToStartCase(field) }}
						</option>
					</select>
					<div class="invalid-feedback">Please select</div>
				</div>
				<div class="mb-3">
					<label for="field" class="form-label">Does Deployment Speed Matter? </label>
					<select
						class="form-select"
						required
						aria-label="select"
						v-model="startupDeploymentSpeed"
					>
						<option v-for="speed in fastDeploymentInfos" :key="speed" :value="speed">
							{{ $convertToStartCase(speed) }}
						</option>
					</select>
					<div class="invalid-feedback">Please select</div>
				</div>
				<div class="mb-3">
					<label for="budget" class="form-label">Startup Budget</label>
					<input type="text" class="form-control form-label"
						placeholder="Startup Budget" aria-label="Budget"
						required v-model="startupBudget"
						@keypress=" $isValidStartupBudget($event,startupBudget)"
					>
					<div class="form-text">Please include average annual salary per person. (e.g 65 -> 65000 USD)</div>
				</div>

				<div class="mb-3">
					<button
						class="btn btn-primary"
						type="submit"
						:disabled="(!startupName || !startupField || !startupDeploymentSpeed || !startupBudget )
							|| isSubmitFormClicked"
					>
						Submit form
						<div
							class="spinner-border spinner-border-sm"
							role="status"
							v-if="isSubmitFormSpinnerActive"
						/>
					</button>
				</div>
			</fieldset>
		</form>
	</div>
</template>

<script>
import { mapGetters, mapActions } from 'vuex';

export default {
	name: 'Form',
	data() {
		return {
			isSubmitted: false,
			isSubmitFormSpinnerActive: false,
			isSubmitFormClicked: false,
		};
	},
	computed: {
		...mapGetters('startupFormData', {
			locations: 'getAvailableLocations',
			sizes: 'getAvailableSizes',
			fields: 'getAvailableFields',
			fastDeploymentInfos: 'getFastDeploymentInfos',
		}),
		startupName: {
			get() {
				return this.$store.state.startupFormData.name;
			},
			set(value) {
				this.$store.commit('startupFormData/UPDATE_NAME', value);
			},
		},
		startupSize: {
			get() {
				return this.$store.getters['startupFormData/getSize'];
			},
			set(value) {
				this.$store.commit('startupFormData/UPDATE_SIZE', value);
			},
		},
		startupLocation: {
			get() {
				return this.$store.getters['startupFormData/getLocation'];
			},
			set(value) {
				this.$store.commit('startupFormData/UPDATE_LOCATION', value);
			},
		},
		startupField: {
			get() {
				return this.$store.getters['startupFormData/getField'];
			},
			set(value) {
				this.$store.commit('startupFormData/UPDATE_FIELD', value);
			},
		},
		startupDeploymentSpeed: {
			get() {
				return this.$store.getters['startupFormData/getDeploymentSpeed'];
			},
			set(value) {
				this.$store.commit('startupFormData/UPDATE_DEPLOYMENT_SPEED', value);
			},
		},
		startupBudget: {
			get() {
				return this.$store.getters['startupFormData/getBudget'];
			},
			set(value) {
				this.$store.commit('startupFormData/UPDATE_BUDGET', value);
			},
		},
	},
	methods: {
		...mapActions('startupFormData', {
			createStartupQuery: 'createStartupQuery',
		}),
		async submit() {
			this.$store.commit('startupChoicesData/RESET_STARTUP_CHOICES');
			this.isSubmitFormSpinnerActive = true;
			this.isSubmitFormClicked = true;
			await this.createStartupQuery();
			this.isSubmitted = true;
			this.isSubmitFormSpinnerActive = false;
			this.isSubmitFormClicked = false;
		},
	},
};
</script>

<style scoped>
.startup-form {
  margin: auto;
  margin-top: 5rem;
  padding: 15px 30px;
  width: 40rem;
  background-color: #fff;
  -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12),
    0 1px 2px rgba(0, 0, 0, 0.24);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
}
</style>